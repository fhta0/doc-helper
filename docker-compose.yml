version: '3.8'

services:
  # 后端服务
  backend:
    image: doc-ai-backend:latest
    build: 
      context: ./backend
      dockerfile: Dockerfile
    container_name: doc-ai-backend
    restart: always
    # 加载 .env 文件中的环境变量
    env_file:
      - ./.env
    volumes:
      - ./uploads:/app/uploads
    # 启动时自动执行初始化
    command: >
      sh -c "python main.py"

  # 前端服务 (使用 Nginx 托管)
  frontend:
    image: doc-ai-frontend:latest
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: doc-ai-frontend
    restart: always
    ports:
      - "8080:80"
      - "443:443"
    depends_on:
      - backend
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./cert:/etc/nginx/cert:ro

